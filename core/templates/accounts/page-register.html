{% load static %}
<!doctype html>
<html lang="en" class="fullscreen-bg">

<head>
	<title>Login | Si Code</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<!-- VENDOR CSS -->
	<link rel="stylesheet" href="/static/assets/vendors/bootstrap-5.1.3/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/assets/vendors/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="/static/assets/vendors/linearicons/style.css">
	<!-- MAIN CSS -->
	<link rel="stylesheet" href="/static/assets/css/main.css">
	<!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
	<link rel="stylesheet" href="/static/assets/css/demo.css">
	<!-- GOOGLE FONTS -->
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">
	<!-- ICONS -->
	<link rel="icon" type="image/png" sizes="96x96" href="/static/assets/img/favicon.png">
</head>

<body>
	<!-- WRAPPER -->
	<div id="wrapper">
		<div class="vertical-align-wrap">
			<div class="vertical-align-middle">
				<div class="auth-box ">
					<div class="left">
						<div class="content">
							<div class="header">
								<div class="logo text-center"><img src="/static/assets/img/logo-dark.png" width="200px" alt="Klorofil Logo"></div>
								<p class="lead">Register New Account</p>
							</div>

							<form class="form-auth-small" action="" method="POST">
								{% csrf_token %}
                                <div class="form-group">
                                    <label for="id_npp">NPP</label>
                                    <input type="text" class="form-control" id="id_npp" name="npp" maxlength="8">
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" id="id_hasil_npp" name="hasil_npp" disabled>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" id="id_no_npp" name="no_pp" style="display:none" disabled>
                                </div>
                                <div class="form-group">
                                    <label for="id_username">Username</label>
                                    <input type="text" class="form-control" id="id_username" name="username">
                                </div>
                                <div class="form-group">
                                    <label for="id_email">Email</label>
                                    <input type="email" name="email" id="id_email" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="id_password1">Password</label>
                                    <input type="password" name="password1" id="id_password1" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="id_password2">Konfirmasi Password</label>
                                    <input type="password" name="password2" id="id_password2" class="form-control">
                                </div>
                                <button type="submit" class="btn btn-primary btn-block">Daftar</button>
								<div class="bottom">
									<span class="helper-text"><i class="fa fa-user"></i> <a href="{% url 'login' %}">Login</a></span>
								</div>
							</form>
						</div>
					</div>
					<div class="right">
						<div class="overlay"></div>
						<div class="content text">
							<h1 class="heading">SCAN THE QR CODE</h1>
							<h1 class="heading">TO GET</h1>
							<h1 class="heading">TO KNOW ME</h1>
							<!-- <hr>
							<br>
							<p style="font-size: 24px;">NAZLY ALFAROKA LUBIS</p>
							<p>Penata Madya Pelayanan</p>
							<p>Kantor Cabang Lhokseumawe</p> -->
						</div>
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
		</div>
	</div>
	<!-- END WRAPPER -->

<!-- JQUERY -->
    <script src="/static/assets/js/jquery.min.js"></script>
    <script src="/static/assets/vendors/bootstrap-5.1.3/js/bootstrap.min.js"></script>
    <script src="/static/assets/js/jquery.dataTables.min.js"></script>
    <script src="/static/assets/js/dataTables.buttons.min.js"></script>
    <script src="/static/assets/js/jszip.min.js"></script>
    <script src="/static/assets/js/pdfmake.min.js"></script>
    <script src="/static/assets/js/vfs_fonts.js"></script>
    <script src="/static/assets/js/buttons.html5.min.js"></script>
    <script src="/static/assets/js/buttons.print.min.js"></script>

    <!-- CoreUI and necessary plugins-->
    <script src="/static/assets/vendors/@coreui/coreui/js/coreui.bundle.min.js"></script>
    <!--[if IE]><!-->
    <script src="/static/assets/vendors/@coreui/icons/js/svgxuse.min.js"></script>

    <!-- Select -->
    <script src="/static/assets/js/select2.min.js"></script>

    <script>
    var namaNpp = ``


$(document).ready(function() {
  $("div input#id_hasil_npp").hide();
  
  $("#id_npp").on("focusout", function(event){
    $(this).val($(this).val().toUpperCase());
    event.preventDefault();
    $("div input#id_hasil_npp").show();
    
    var value = $(this).val().toUpperCase();
    $.ajax({
      type:'GET',
      url:"{% url 'api-perusahaan' %}" + `?search=${value}`,
      async: true,
      success:function(data){
        if(data.length > 0) {
          
          $("#id_hasil_npp").val(data[0]['nama']).attr("value",`${data[0]['nama']}`)
          $("#id_no_npp").attr("value",`${data[0]['id']}`)
          
        }
        else{
          $("#id_hasil_npp").val("NPP Tidak Ditemukan!!!")
          $("#id_no_npp").attr("value",null)
        }
      },
      error: function(xhr, status, error){
        var err = JSON.parse(xhr.responseText);
        console.log(status)
        alert(err)
      }
    });
  
  $(document).on('submit', '#id_form',function(e){
    e.preventDefault();
    
    $.ajax({
      type:'POST',
      url:"{% url 'create-user' %}",
      
      data: {
        username:$("#id_username").val(),
        password1:$("#id_password1").val(),
        password2:$("#id_password2").val(),
        no_npp:$("#id_no_npp").val(),
        csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
        dataType: "json",
      },
      success: function(data){
        console.log(data)
        $("p.text-muted").html(data.msg);
        $("input.form-control").val("");
        $("div input#id_hasil_npp").hide();
      },
      error:function(err){
        console.log(err)
      }
    });
  });
});
})

    </script>
</body>

</html>
